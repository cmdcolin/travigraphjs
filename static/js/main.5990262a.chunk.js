(this.webpackJsonptravigraphjs=this.webpackJsonptravigraphjs||[]).push([[0],{114:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),o=a(58),i=a.n(o),c=(a(74),a(29)),s=a(4),u=a(3),l=a.n(u),d=a(5),m=a(14),b=a(120),p=a(59),h=a.n(p),f=a(60),v=a.n(f),g=a(61),j=a(21);var O=function(e){var t=e.onSubmit,a=e.initialValues,n=Object(j.b)({onSubmit:t,initialValues:a}),o=n.form,i=n.handleSubmit,c=n.pristine,s=n.submitting,u=Object(j.a)("repo",o),l=Object(j.a)("token",o),d=Object(j.a)("com",o);return r.a.createElement("form",{onSubmit:i},r.a.createElement("div",null,r.a.createElement("label",null,"Repo name"),r.a.createElement("input",u.input)),r.a.createElement("div",null,r.a.createElement("label",null,"Authorization token (only needed for private)"),r.a.createElement("input",l.input)),r.a.createElement("div",null,r.a.createElement("label",null,"On travis-ci.com instead of travis-ci.org?"),r.a.createElement("input",Object.assign({type:"checkbox",id:d.input.name,checked:d.input.value},d.input))),r.a.createElement("button",{type:"submit",disabled:c||s},"Submit"))};function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return[];var t=e.concat();t.sort((function(e,t){return e.duration-t.duration}));var a=t[Math.floor(t.length/4)].duration,n=t[Math.min(Math.ceil(t.length*(3/4)),t.length-1)].duration,r=n-a,o=n+3*r,i=a-3*r;return t.filter((function(e){return e.duration<o&&e.duration>i&&!!e.finished_at}))}var k=a(47),w=a.n(k),x={$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:1e3,height:400,mark:{type:"point",tooltip:{content:"data"}},data:{name:"values"},selection:{grid:{type:"interval",bind:"scales"}},encoding:{y:{field:"duration",type:"quantitative",axis:{title:"Duration (minutes)"}},x:{field:"finished_at",timeUnit:"yearmonthdatehoursminutes",type:"temporal",scale:{nice:"week"},axis:{title:"Date"}},color:{field:"state",type:"nominal",scale:{domain:["passed","failed","errored","canceled"],range:["#39aa56","#ff7f0e","#db4545","#9d9d9d"]}}}},y=new h.a({cache:new v.a({maxSize:1e3}),fill:function(e,t){return Object(d.a)(l.a.mark((function a(){var n,r,o,i,c,s;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.url,r=e.headers,o=w.a.get(JSON.stringify(e))){a.next=15;break}return a.next=5,Object(g.a)(n,{headers:r,signal:t});case 5:if((i=a.sent).ok){a.next=8;break}throw new Error("failed http status ".concat(i.status));case 8:return a.next=10,i.json();case 10:return c=a.sent,console.log(c),s=E(c.builds.map((function(e){return{message:(e.commit||{}).message.slice(0,20),branch:(e.branch||{}).name,duration:e.duration/60,number:e.number,commit_sha:e.commit.sha,compare:e.commit.compare_url,finished_at:e.finished_at,state:e.state}}))),w.a.set(JSON.stringify(e),s),a.abrupt("return",s);case 15:return a.abrupt("return",o);case 16:case"end":return a.stop()}}),a)})))()}});function S(e){var t=e.counter,a=e.com,n=e.repo,r=e.end,o="https://api.travis-ci.".concat(a?"com":"org","/repo/").concat(encodeURIComponent(n),"/builds?limit=").concat(100),i=100*t,c="".concat(o,"&offset=").concat(i,"&sort_by=id");return i<r?c:void 0}function A(e){var t=e.com,a=e.repo;return"https://api.travis-ci.".concat(t?"com":"org","/repo/").concat(encodeURIComponent(a),"/builds?limit=1&offset=-1")}function _(){var e=Object(n.useState)(new AbortController),t=Object(s.a)(e,2),a=t[0],o=t[1],i=Object(m.d)({repo:m.c,start:m.b,end:m.b,com:m.a,token:m.c}),u=Object(s.a)(i,2),p=u[0],h=u[1],f=function(e,t){var a=Object(n.useState)(0),r=Object(s.a)(a,2),o=r[0],i=r[1],u=Object(n.useState)(),m=Object(s.a)(u,2),b=m[0],p=m[1],h=Object(n.useState)(t.repo?"Loading...":"Enter a repo"),f=Object(s.a)(h,2),v=f[0],g=f[1],j=Object(n.useState)([]),O=Object(s.a)(j,2),E=O[0],k=O[1],w=Object(n.useState)(),x=Object(s.a)(w,2),_=x[0],C=x[1],R={"Travis-API-Version":"3"};t.token&&(R.Authorization="token "+t.token);var I=new Headers(R);return Object(n.useEffect)((function(){Object(d.a)(l.a.mark((function e(){var a,n,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==_||void 0===t.repo){e.next=9;break}return a=A(t),e.next=4,fetch(a,{headers:I});case 4:return n=e.sent,e.next=7,n.json();case 7:(r=e.sent.builds)&&r.length&&(o=+r[0].number,C(o));case 9:case"end":return e.stop()}}),e)})))()})),Object(n.useEffect)((function(){Object(d.a)(l.a.mark((function a(){var n,r;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,void 0===_){a.next=14;break}if(!t||!t.repo){a.next=14;break}if(g("Loading build ".concat(100*o,"/").concat(_)),!(n=S(Object(c.a)({},t,{counter:o,end:_})))){a.next=13;break}return a.next=8,y.get(JSON.stringify({url:n,headers:I}),{url:n,headers:I},e);case 8:r=a.sent,k(E.concat(r)),i(o+1),a.next=14;break;case 13:E.length?g(void 0):p("No builds loaded");case 14:a.next=19;break;case 16:a.prev=16,a.t0=a.catch(0),"AbortError"!==(s=a.t0).name&&"ERR_ABORTED"!==s.code&&"AbortError: aborted"!==s.message&&"Error: aborted"!==s.message&&(console.error(a.t0),p(a.t0.message));case 19:case"end":return a.stop()}var s}),a,null,[[0,16]])})))()}),[v,t,o,E,e,I,_]),[v,b,E]}(a.signal,p),v=Object(s.a)(f,3),g=v[0],j=v[1],E=v[2];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"travigraph-js - Travis-CI duration graph"),r.a.createElement("p",null,"Enter a repo name and optionally an authorization token, used for private repos Also specify whether this is on travis-ci.com or travis-ci.org with the checkbox. NOTE: The repository name is case sensitive!"),r.a.createElement(O,{initialValues:p,onSubmit:function(e){g&&a.abort(),o(new AbortController),h(e)},onCancel:function(){g&&a.abort()}}),j?r.a.createElement("p",{style:{color:"red"}},j):g?r.a.createElement("p",null,g):r.a.createElement(b.a,{data:{values:E},spec:x}),r.a.createElement("a",{href:"https://github.com/cmdcolin/travigraphjs/"},"travigraph@GitHub"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(_,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},69:function(e,t,a){e.exports=a(114)},74:function(e,t,a){}},[[69,1,2]]]);
//# sourceMappingURL=main.5990262a.chunk.js.map